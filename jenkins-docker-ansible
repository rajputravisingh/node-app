pipeline{
    agent any
    environment
    {
        DOCKER_TAG = getDockertag()
    }
        stages{
            stage('Code checkout')
            {
                steps
                {
                   git credentialsId: 'GitHub', url: 'https://github.com/rajputravisingh/node-app.git'
                }
            }
            stage('Docker-Build')
            {
                steps
                {
                   sh 'docker build . -t rajputmarch2020/nodeapp:${DOCKER_TAG}' 
                }
            }
            
            stage('DockerHub-image-push'){
            steps{
                withCredentials([string(credentialsId: 'dockerhub', variable: 'password')]) {
                sh 'docker login -u rajputmarch2020 -p ${password} '
                }
                sh 'docker push rajputmarch2020/sample-app:${DOCKER_TAG}'
            }
        }
        }
    }

def getDockertag()
{
    def tag = sh returnStdout: true, script: 'git rev-parse HEAD'
    return tag

}




